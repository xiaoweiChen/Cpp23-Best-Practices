这个问题最好通过一系列示例来说明。先从这个例子开始：

\filename{图 100. 带有警告的 'switch' 语句}
\begin{cpp}
enum class Values {
  val1,
  val2
};

[[nodiscard]] constexpr std::string_view get_name(Values value) {
  switch (value) {
  case Values::val1: return "val1";
  case Values::val2: return "val2";
  }
}
\end{cpp}

如果你启用了所有警告，那么你很可能会收到一个“并非所有代码路径都返回值”的警告。这在技术上是正确的。我们可以调用 \verb|get_name(static_cast<Values>(15))|，这除了因函数未返回值而导致未定义行为外，并不违反 C++ 标准 [dcl.enum/5] 的任何部分。

你可能会想这样修复这段代码：

\filename{图 101. 使用 'default' 来避免警告的 'switch' 语句}
\begin{cpp}
enum class Values {
  val1,
  val2
};

[[nodiscard]] constexpr std::string_view get_name(Values value) {
  switch (value) {
  case Values::val1: return "val1";
  case Values::val2: return "val2";
  default: return "unknown";
  }
}
\end{cpp}

但这引入了一个新问题：

\filename{图 102. 未处理的情况}
\begin{cpp}
enum class Values {
  val1,
  val2,
  val3 // 添加了一个新值
};

[[nodiscard]] constexpr std::string_view get_name(Values value) {
  switch (value) {
  case Values::val1: return "val1";
  case Values::val2: return "val2";
  default: return "unknown";
  }
  // 没有编译器诊断提示 val3 未被处理
}
\end{cpp}

相反，建议使用如下代码：

\filename{图 103. 推荐版本}
\begin{cpp}
enum class Values {
  val1,
  val2,
  val3 // 添加了一个新值
};

[[nodiscard]] constexpr std::string_view get_name(Values value) {
  switch (value) {
  case Values::val1: return "val1";
  case Values::val2: return "val2";
  } // 现在会触发未处理枚举值的警告

  return "unknown";
}
\end{cpp}

\begin{myTip}{}
在上面的例子中，你不应该收到“不可达代码”的警告，因为有效值的范围几乎总是大于你已定义的值。
\end{myTip}

\begin{myNotic}{}
一些现代工具可以帮你检测到这些对 default 的使用情况。
\end{myNotic}

\begin{myTip}{练习：查找 default:}
在你的代码库中找到了什么？在之前的练习中启用警告是否已经帮你发现了 default: 的使用？
\end{myTip}

\begin{myTip}{练习：考虑使用 std::unreachable。}
std::unreachable（在 C++23 中引入）如果被执行，则会显式地引发未定义行为。它可以用于 switch 语句的“不可达”情况，以确保编译器执行最优操作。
这听起来可能有些吓人。你真的想要因为代码“不可能”被执行到而引入未定义行为吗？与你的同事讨论一下，并考虑在何处、何时以及是否要使用这个工具。更多细节请参见资源中的 C++ Weekly 视频。
\end{myTip}

\mySubsectionNoFile{53.1}{资源}

\begin{itemize}
\item
CppCon 2018: Jason Turner “应用最佳实践”\footnote{\url{https://youtu.be/DHOlsEd0eDE}}

\item
C++ Weekly -  第 393 集 - C++23 的 std::unreachable\footnote{\url{https://youtu.be/ohMyb4jPIAQ}}* -Wswitch-enum\footnote{\url{https://clang.llvm.org/docs/DiagnosticsReference.html\#wswitch-enum}}

\item
-Wswitch\footnote{\url{https://clang.llvm.org/docs/DiagnosticsReference.html\#wswitch}}
\end{itemize}




